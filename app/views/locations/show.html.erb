<p id="notice"><%= notice %></p>

<p>
  <b>User:</b>
  <%= @location.user_id %>
</p>

<p>
  <b>Name:</b>
  <%= @location.name %>
</p>

<p>
  <b>Phone number:</b>
  <%= @location.phone_number %>
</p>

<p>
  <b>Street address:</b>
  <%= @location.street_address %>
</p>

<p>
  <b>Intro paragraph:</b>
  <%= @location.intro_paragraph %>
</p>

<p>
  <b>Latitude:</b>
  <%= @location.latitude %>
</p>

<p>
  <b>Longitude:</b>
  <%= @location.longitude %>
</p>

<p>
  <b>Logo:</b>
  <%= @location.logo %>
</p>

<p>
  <b>Website url:</b>
  <%= @location.website_url %>
</p>

<p>
  <b>Facebook url:</b>
  <%= @location.facebook_url %>
</p>

<p>
  <b>Twitter url:</b>
  <%= @location.twitter_url %>
</p>

<p>
  <b>Full address:</b>
  <%= @location.full_address %>
</p>

<p>
  <b>City:</b>
  <%= @location.city %>
</p>

<p>
  <b>Zip code:</b>
  <%= @location.zip_code %>
</p>

<p>
  <b>State:</b>
  <%= @location.state %>
</p>

<p>
  <b>Slug:</b>
  <%= @location.slug %>
</p>


<%= link_to 'Edit', edit_location_path(@location) %> |
<%= link_to 'Back', locations_path %>

</br>
</br>

<head>
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Google Maps JavaScript API v3 Example: Street View Layer</title>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
    <script>
      function initialize() {
        var maplocation = new google.maps.LatLng(<%= @location.latitude %>,<%= @location.longitude %>);
        var mapOptions = {
          center: maplocation,
          zoom: 14,
          mapTypeId: google.maps.MapTypeId.ROADMAP,
        };
        var map = new google.maps.Map(document.getElementById('map_canvas'), mapOptions);
		var image = '/assets/marker-blue.png';
		var marker = new google.maps.Marker({
		            position: maplocation,
		            map: map,
					icon: image,
					title: '<%= @location.name %>'
		        });
		}
    </script>
</head>

<% content_for :head do %>
  	<meta property="fb:app_id" content="567808586566843" /> 
  	<meta property="og:type"   content="listdnow:bar" /> 
  	<meta property="og:url"    content="<%= @full_path %>" /> 
  	<meta property="og:title"  content="<%=@location.name %>" /> 
  	<meta property="og:image" content="http://cdn1.iconfinder.com/data/icons/Symbolicons_Drink/502/Drink_BeerPint.png"  /> 
<% end %>

<% content_for :title, "Listd - #{@location.name}" %>

<div>
	<div class="row">
  		<div class="pull-left span7" id="bar-main">
    		<h3> <%= @location.name %> </h3>
    		<address>
	  			<small style = "line-height:.7em">	<%= @location.street_address %>, <%= @location.city%>,  <%=@location.state%> <%=@location.zip_code%> </small>
    		</address>
			<div class="row">
      			<body onload="initialize()">
	    			<div id="map_canvas" class="map span6"></div>
      			</body>
			</div>
  		</div>

  		<div class="pull-left span3" id="bar-info">
            <div>
    			<h5>Contact</h5>
    			<small>
					<abbr title="Phone">P: </abbr><%= number_to_phone(@location.phone_number, :area_code => true) %>
				</small>
    			</br>
				<% if @location.website_url != "" %>
					<small>
						<%= link_to @location.website_url, "http://#{@location.website_url}", :target => "_blank"%></br>
					</small>
				<% end %>
    			<% if @location.facebook_url != "" %>
					<%= link_to image_tag("fb_icon(bar).png"), @location.facebook_url %>
				<% end %>
				<% if @location.twitter_url != "" %>
					<%= link_to image_tag("twitter_icon(bar).png"), @location.twitter_url %>
				<% end %>
    			</br>
            </div>
  		</div>
		
		<% if @ticket_sets.empty? %>
			<div class="shadow span11 center-text" id="passes-none">
  				<h2>Sorry, there are no available tickets at this time</h2>
			</div>
		<% end %>
		
  		<% if @ticket_sets.empty? == false %>
			<div class="span11" id="passes-avail">
	  			<div class="div-header">
        			<h5>Available Tickets</h5>
					<small>A LISTD ticket provides immediate entry to <%= @location.name %>.</small>
	  			</div>
	  			<% @ticket_sets.each do |ticket_set| %>
					<div class="date-box span1 center-text">
	      				<p class="lead"><%= link_to ticket_set.fecha.date.strftime("%d"), [@location, ticket_set] %></p>
		  				<div>
							<%= link_to ticket_set.fecha.date.strftime("%a"), [@location, ticket_set] %>
						</div>
					</div>
	  			<% end %>
			</div>
		<% end %>
		
		<% if @pass_sets.empty? %>
			<div class="shadow span11 center-text" id="passes-none">
  				<h2>Sorry, there are no available passes at this time.</h2>
			</div>
		<% end %>
		
  		<% if @pass_sets.empty? == false %>
			<div class="span11" id="passes-avail">
	  			<div class="div-header">
        			<h5>Available Passes</h5>
					<small>A LISTD pass provides immediate entry to <%= @location.name %>.</small>
	  			</div>
	  			<% @pass_sets.each do |pass_set| %>
					<div class="date-box span1 center-text">
	      				<p class="lead"><%= link_to pass_set.fecha.date.strftime("%d"), [@location, pass_set] %></p>
		  				<div>
							<%= link_to pass_set.fecha.date.strftime("%a"), [@location, pass_set] %>
						</div>
					</div>
	  			<% end %>
			</div>
		<% end %>
		
		<% if @deal_sets.empty? %>
			<div class="shadow span11 center-text" id="passes-none">
  				<h2>Sorry, there are no available deals at this time.</h2>
			</div>
		<% end %>
		
  		<% if @deal_sets.empty? == false %>
			<div class="span11" id="passes-avail">
	  			<div class="div-header">
        			<h5>Available Deals</h5>
					<small>A LISTD deal provides immediate entry to <%= @location.name %>.</small>
	  			</div>
	  			<% @deal_sets.each do |deal_set| %>
					<div class="date-box span1 center-text">
	      				<p class="lead"><%= link_to deal_set.fecha.date.strftime("%d"), [@location, deal_set] %></p>
		  				<div>
							<%= link_to deal_set.fecha.date.strftime("%a"), [@location, deal_set] %>
						</div>
					</div>
	  			<% end %>
			</div>
		<% end %>
		
	</div>
</div>

<%if(user_signed_in? && current_user.admin?) %>
	<div>
		<%if @ticket_sets.empty? %>
			<h5>No Active Ticket Sets</h5>
		<% else %>
			<h5>Active Ticket Sets</h5>
            <div class = "passSetTable">
				<table cellpadding="10">
                <thead>
  					<tr>
    					<th>Date</th>
    					<th>Released Tickets</th>
    					<th>Sold</th>
    					<th>Unsold</th>
    					<th>Price</th>
						<th>Earnings</th>
    					<th></th>
						<th></th>
						<th></th>
						<th></th>
  					</tr>
                </thead>
                <tbody>
					<% @ticket_sets.each do |ticket_set| %>
  						<tr>
    						<td data-title="Date"><%= ticket_set.fecha.date %></td>
    						<td data-title="Released Passes"><%= ticket_set.total_released_tickets %></td>
    						<td data-title="Sold"><%= ticket_set.sold_tickets %></td>
    						<td data-title="Unsold"><%= ticket_set.unsold_tickets %></td>
							<% if ticket_set.price_point != nil %>
								<td data-title="Price"><%= number_to_currency(ticket_set.price_point.price) %></td>
							<% else %>
								<td data-title="Price"> 0 </td>
							<% end %>
							<td data-title="Revenue"><%= number_to_currency(ticket_set.revenue_total) %></td>

							<%if(user_signed_in? && current_user.admin?) %>
    							<td><%= link_to 'Show Purchased Tickets', [@location.user, @location, ticket_set] %></td>
								<td><%= link_to 'Edit', edit_user_location_ticket_set_path(@location.user, @location, ticket_set) %></td>
								<td><%= link_to 'Close Out', user_location_ticket_set_close_set_path(@location.user, @location, ticket_set), :confirm => 'Are you sure?' %></td>
								<td><%= link_to 'Delete', [@location.user, @location, ticket_set], :confirm => 'Are you sure?', :method => :delete %> </td>
			   				<%elsif (current_user.partner?)%>
			      				<td><%= link_to 'Show Purchased Passes', [@location, ticket_set] %></td>
				   			<%else %>
			    				<td><%= link_to 'Purchase a Pass', [@location, ticket_set] %></td>   
			   				<%end%>
  						</tr>
					<% end %>
                </tbody>
				</table>
			</div>
		<% end %>
		
		<%if @pass_sets.empty? %>
			<h5>No Active Pass Sets</h5>
		<% else %>
			<h5>Active Pass Sets</h5>
            <div class = "passSetTable">
				<table cellpadding="10">
                <thead>
  					<tr>
    					<th>Date</th>
    					<th>Released Passes</th>
    					<th>Sold</th>
    					<th>Unsold</th>
    					<th>Price</th>
						<th>Earnings</th>
    					<th></th>
						<th></th>
						<th></th>
						<th></th>
  					</tr>
                </thead>
                <tbody>
					<% @pass_sets.each do |pass_set| %>
  						<tr>
    						<td data-title="Date"><%= pass_set.fecha.date %></td>
    						<td data-title="Released Passes"><%= pass_set.total_released_passes %></td>
    						<td data-title="Sold"><%= pass_set.sold_passes %></td>
    						<td data-title="Unsold"><%= pass_set.unsold_passes %></td>
							<% if pass_set.price_point != nil %>
								<td data-title="Price"><%= number_to_currency(pass_set.price_point.price) %></td>
							<% else %>
								<td data-title="Price"> 0 </td>
							<% end %>
							<td data-title="Revenue"><%= number_to_currency(pass_set.revenue_total) %></td>

							<%if(user_signed_in? && current_user.admin?) %>
    							<td><%= link_to 'Show Purchased Passes', [@location.user, @location, pass_set] %></td>
								<td><%= link_to 'Edit', edit_user_location_pass_set_path(@location.user, @location, pass_set) %></td>
								<td><%= link_to 'Close Out', user_location_pass_set_close_set_path(@location.user, @location, pass_set), :confirm => 'Are you sure?' %></td>
								<td><%= link_to 'Delete', [@location.user, @location, pass_set], :confirm => 'Are you sure?', :method => :delete %> </td>
			   				<%elsif (current_user.partner?)%>
			      				<td><%= link_to 'Show Purchased Passes', [@location, pass_set] %></td>
				   			<%else %>
			    				<td><%= link_to 'Purchase a Pass', [@location, pass_set] %></td>   
			   				<%end%>
  						</tr>
					<% end %>
                </tbody>
				</table>
			</div>
		<% end %>
		<%if @deal_sets.empty? %>
			<h5>No Active Deal Sets</h5>
		<% else %>
			<h5>Active Deal Sets</h5>
            <div class = "passSetTable">
				<table cellpadding="10">
                <thead>
  					<tr>
    					<th>Date</th>
    					<th>Released Deals</th>
    					<th>Sold</th>
    					<th>Unsold</th>
    					<th>Price</th>
						<th>Earnings</th>
    					<th></th>
						<th></th>
						<th></th>
						<th></th>
  					</tr>
                </thead>
                <tbody>
					<% @deal_sets.each do |deal_set| %>
  						<tr>
    						<td data-title="Date"><%= deal_set.fecha.date %></td>
    						<td data-title="Released Passes"><%= deal_set.total_released_deals %></td>
    						<td data-title="Sold"><%= deal_set.sold_deals %></td>
    						<td data-title="Unsold"><%= deal_set.unsold_deals %></td>
							<% if deal_set.price_point != nil %>
								<td data-title="Price"><%= number_to_currency(deal_set.price_point.price) %></td>
							<% else %>
								<td data-title="Price"> 0 </td>
							<% end %>
							<td data-title="Revenue"><%= number_to_currency(deal_set.revenue_total) %></td>

							<%if(user_signed_in? && current_user.admin?) %>
    							<td><%= link_to 'Show Purchased Deals', [@location.user, @location, deal_set] %></td>
								<td><%= link_to 'Edit', edit_user_location_deal_set_path(@location.user, @location, deal_set) %></td>
								<td><%= link_to 'Close Out', user_location_deal_set_close_set_path(@location.user, @location, deal_set), :confirm => 'Are you sure?' %></td>
								<td><%= link_to 'Delete', [@location.user, @location, deal_set], :confirm => 'Are you sure?', :method => :delete %> </td>
			   				<%elsif (current_user.partner?)%>
			      				<td><%= link_to 'Show Purchased Deals', [@location, deal_set] %></td>
				   			<%else %>
			    				<td><%= link_to 'Purchase a Deal', [@location, deal_set] %></td>   
			   				<%end%>
  						</tr>
					<% end %>
                </tbody>
				</table>
			</div>
		<% end %>
	</div>
</br>

<%= link_to 'New Ticket Set', new_user_location_ticket_set_path(@user,@location) %> |
<%= link_to 'New Pass Set', new_user_location_pass_set_path(@user,@location) %> |
<%= link_to 'New Deal Set', new_user_location_deal_set_path(@user,@location) %> |
<%= link_to 'Edit Bar Information', edit_user_location_path(@user,@location) %> |
<%= link_to 'Delete Bar Location', [@user,@location], :confirm => 'Are you sure?', :method => :delete %> |
<%= link_to 'Back', @user %>

<% elsif(user_signed_in? && current_user.partner?) %>
	<% if current_user.admin? %>
		<%= link_to 'Edit Bar Information', edit_bar_path(@location) %> |
	<% end %>
	<%= link_to 'Back', root_path %>
<% end %>

